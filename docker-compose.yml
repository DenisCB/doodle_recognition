version: "3.7"
services:
  flask:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - FLASK_DEBUG=1
      - FLASK_APP=main.py
      - PYTHONUNBUFFERED=True
    ports:
      - 5000:5001
    command: flask run --host=0.0.0.0 --port=5001 # for debugging
    # command: gunicorn -w 1 -b 0.0.0.0:5001 main:app 
    container_name: doodles
    volumes:
      - .:/root
      
  db:
    image: postgres
    environment:
      - POSTGRES_DB=doodles
      - POSTGRES_USER=denis
    restart: always
    ports:
      - "5433:5432" # 5433 is exposed to localhost, but not to other docker apps
    container_name: doodles_db
    volumes:
      - ./pgdata:/var/lib/postgresql/data
